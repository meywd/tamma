{
  "description": "Database configuration for Test Platform",
  "story": "1.1 Database Schema Migration System",
  "task": "1 - Database Setup and Configuration",
  "environments": {
    "development": {
      "primary": {
        "host": "localhost",
        "port": 5432,
        "database": "test_platform",
        "user": "test_platform_user",
        "password": "${DB_PASSWORD}",
        "ssl": false,
        "connectionString": "postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}"
      },
      "pooled": {
        "host": "localhost",
        "port": 6432,
        "database": "test_platform",
        "user": "test_platform_user",
        "password": "${DB_PASSWORD}",
        "ssl": false,
        "connectionString": "postgresql://${DB_USER}:${DB_PASSWORD}@localhost:6432/${DB_NAME}",
        "poolConfig": {
          "min": 5,
          "max": 20,
          "idleTimeoutMillis": 30000,
          "connectionTimeoutMillis": 2000,
          "statementTimeout": 30000
        }
      },
      "migrations": {
        "directory": "./database/migrations",
        "tableName": "schema_migrations",
        "validateChecksums": true
      },
      "backup": {
        "enabled": true,
        "schedule": "0 2 * * *",
        "retentionDays": 7,
        "location": "./database/backups"
      }
    },
    "test": {
      "primary": {
        "host": "localhost",
        "port": 5432,
        "database": "test_platform_test",
        "user": "test_platform_user",
        "password": "${DB_PASSWORD}",
        "ssl": false,
        "connectionString": "postgresql://${DB_USER}:${DB_PASSWORD}@${DB_HOST}:${DB_PORT}/${DB_NAME}_test"
      },
      "pooled": {
        "host": "localhost",
        "port": 6432,
        "database": "test_platform_test",
        "user": "test_platform_user",
        "password": "${DB_PASSWORD}",
        "ssl": false,
        "connectionString": "postgresql://${DB_USER}:${DB_PASSWORD}@localhost:6432/${DB_NAME}_test",
        "poolConfig": {
          "min": 2,
          "max": 10,
          "idleTimeoutMillis": 10000,
          "connectionTimeoutMillis": 2000,
          "statementTimeout": 10000
        }
      },
      "migrations": {
        "directory": "./database/migrations",
        "tableName": "schema_migrations",
        "validateChecksums": true
      }
    },
    "staging": {
      "primary": {
        "host": "${STAGING_DB_HOST}",
        "port": 5432,
        "database": "test_platform_staging",
        "user": "${STAGING_DB_USER}",
        "password": "${STAGING_DB_PASSWORD}",
        "ssl": {
          "rejectUnauthorized": false,
          "ca": "${STAGING_DB_CA_CERT}"
        },
        "connectionString": "postgresql://${STAGING_DB_USER}:${STAGING_DB_PASSWORD}@${STAGING_DB_HOST}:5432/test_platform_staging?sslmode=require"
      },
      "pooled": {
        "host": "${STAGING_PGBOUNCER_HOST}",
        "port": 6432,
        "database": "test_platform_staging",
        "user": "${STAGING_DB_USER}",
        "password": "${STAGING_DB_PASSWORD}",
        "ssl": {
          "rejectUnauthorized": false
        },
        "connectionString": "postgresql://${STAGING_DB_USER}:${STAGING_DB_PASSWORD}@${STAGING_PGBOUNCER_HOST}:6432/test_platform_staging?sslmode=require",
        "poolConfig": {
          "min": 10,
          "max": 50,
          "idleTimeoutMillis": 30000,
          "connectionTimeoutMillis": 5000,
          "statementTimeout": 60000
        }
      },
      "migrations": {
        "directory": "./database/migrations",
        "tableName": "schema_migrations",
        "validateChecksums": true
      },
      "backup": {
        "enabled": true,
        "schedule": "0 1 * * *",
        "retentionDays": 14,
        "location": "s3://backups/staging/database"
      }
    },
    "production": {
      "primary": {
        "host": "${PROD_DB_HOST}",
        "port": 5432,
        "database": "test_platform_prod",
        "user": "${PROD_DB_USER}",
        "password": "${PROD_DB_PASSWORD}",
        "ssl": {
          "rejectUnauthorized": true,
          "ca": "${PROD_DB_CA_CERT}",
          "cert": "${PROD_DB_CLIENT_CERT}",
          "key": "${PROD_DB_CLIENT_KEY}"
        },
        "connectionString": "postgresql://${PROD_DB_USER}:${PROD_DB_PASSWORD}@${PROD_DB_HOST}:5432/test_platform_prod?sslmode=require"
      },
      "pooled": {
        "host": "${PROD_PGBOUNCER_HOST}",
        "port": 6432,
        "database": "test_platform_prod",
        "user": "${PROD_DB_USER}",
        "password": "${PROD_DB_PASSWORD}",
        "ssl": {
          "rejectUnauthorized": true,
          "ca": "${PROD_DB_CA_CERT}"
        },
        "connectionString": "postgresql://${PROD_DB_USER}:${PROD_DB_PASSWORD}@${PROD_PGBOUNCER_HOST}:6432/test_platform_prod?sslmode=require",
        "poolConfig": {
          "min": 20,
          "max": 100,
          "idleTimeoutMillis": 60000,
          "connectionTimeoutMillis": 5000,
          "statementTimeout": 120000
        }
      },
      "readReplica": {
        "host": "${PROD_DB_READ_HOST}",
        "port": 5432,
        "database": "test_platform_prod",
        "user": "${PROD_DB_READ_USER}",
        "password": "${PROD_DB_READ_PASSWORD}",
        "ssl": {
          "rejectUnauthorized": true,
          "ca": "${PROD_DB_CA_CERT}"
        },
        "connectionString": "postgresql://${PROD_DB_READ_USER}:${PROD_DB_READ_PASSWORD}@${PROD_DB_READ_HOST}:5432/test_platform_prod?sslmode=require"
      },
      "migrations": {
        "directory": "./database/migrations",
        "tableName": "schema_migrations",
        "validateChecksums": true,
        "runInTransaction": true
      },
      "backup": {
        "enabled": true,
        "schedule": "0 0 * * *",
        "retentionDays": 30,
        "location": "s3://backups/production/database",
        "encryption": true
      }
    }
  },
  "features": {
    "jsonb": {
      "enabled": true,
      "extensions": ["btree_gin", "btree_gist"],
      "indexStrategy": "gin"
    },
    "uuid": {
      "enabled": true,
      "extension": "uuid-ossp",
      "defaultFunction": "gen_random_uuid()"
    },
    "fullTextSearch": {
      "enabled": false,
      "extension": "pg_trgm",
      "languages": ["english"]
    },
    "timeSeries": {
      "enabled": false,
      "extension": "timescaledb"
    }
  },
  "monitoring": {
    "slowQueryThreshold": 1000,
    "logSlowQueries": true,
    "logConnections": true,
    "logDisconnections": true,
    "statementTimeout": 300000,
    "lockTimeout": 10000,
    "idleInTransactionTimeout": 60000
  },
  "performance": {
    "maxConnections": 200,
    "sharedBuffers": "256MB",
    "effectiveCacheSize": "1GB",
    "workMem": "4MB",
    "maintenanceWorkMem": "64MB",
    "randomPageCost": 1.1,
    "effectiveIoConcurrency": 200,
    "walLevel": "replica",
    "maxWalSize": "1GB",
    "minWalSize": "80MB",
    "checkpointTimeout": "5min",
    "checkpointCompletionTarget": 0.7
  },
  "security": {
    "requireSSL": false,
    "allowedHosts": ["localhost", "127.0.0.1"],
    "passwordEncryption": "scram-sha-256",
    "rowLevelSecurity": false,
    "auditLogging": false
  },
  "healthCheck": {
    "enabled": true,
    "interval": 30000,
    "timeout": 5000,
    "query": "SELECT 1",
    "retries": 3
  }
}